# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»º
FROM node:18-alpine AS builder

WORKDIR /app

# ğŸ‘‡ å…³é”®ï¼å…ˆåªå¤åˆ¶ package.json å’Œ package-lock.json
# å¦‚æœè¿™ä¸¤ä¸ªæ–‡ä»¶æ²¡å˜ï¼ŒDocker ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜å±‚ï¼Œè·³è¿‡ npm installï¼
COPY package*.json ./

# è®¾ç½®å›½å†…é•œåƒ
RUN npm config set registry https://registry.npmmirror.com

# å®‰è£…ä¾èµ– â€”â€” åªæœ‰ package*.json æ”¹å˜æ—¶æ‰ä¼šé‡æ–°æ‰§è¡Œè¿™ä¸€æ­¥ï¼
RUN npm install

# ğŸ‘‡ å†å¤åˆ¶æºç ï¼ˆæºç å˜åŠ¨ä¸ä¼šè§¦å‘é‡æ–° installï¼‰
COPY . .

# æ„å»ºé¡¹ç›®
RUN npm run build

# ç¬¬äºŒé˜¶æ®µï¼šéƒ¨ç½²
FROM nginx:alpine

RUN rm -rf /usr/share/nginx/html/*

# æ ¹æ®ä½ çš„é¡¹ç›®ä¿®æ”¹ç›®å½•ï¼ˆVue: dist, React: build, etc.ï¼‰
COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]